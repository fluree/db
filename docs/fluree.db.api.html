<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>fluree.db.api documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">com.fluree/db</span> <span class="project-version">3.0.0-alpha2</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="fluree.db.api.html"><div class="inner"><span>fluree.db.api</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="fluree.db.api.html#var-address.3F"><div class="inner"><span>address?</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-alias-.3Eaddress"><div class="inner"><span>alias-&gt;address</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-commit.21"><div class="inner"><span>commit!</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-connect"><div class="inner"><span>connect</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-connect-file"><div class="inner"><span>connect-file</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-connect-memory"><div class="inner"><span>connect-memory</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-connect-s3"><div class="inner"><span>connect-s3</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-convert-config-key"><div class="inner"><span>convert-config-key</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-convert-keys"><div class="inner"><span>convert-keys</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-create"><div class="inner"><span>create</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-create-with-txn"><div class="inner"><span>create-with-txn</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-credential-history"><div class="inner"><span>credential-history</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-credential-query"><div class="inner"><span>credential-query</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-credential-query-connection"><div class="inner"><span>credential-query-connection</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-credential-transact.21"><div class="inner"><span>credential-transact!</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-credential-update.21"><div class="inner"><span>credential-update!</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-dataset"><div class="inner"><span>dataset</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-db"><div class="inner"><span>db</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-decode-iri"><div class="inner"><span>decode-iri</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-disconnect"><div class="inner"><span>disconnect</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-drop"><div class="inner"><span>drop</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-encode-iri"><div class="inner"><span>encode-iri</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-exists.3F"><div class="inner"><span>exists?</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-expand-iri"><div class="inner"><span>expand-iri</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-format-txn"><div class="inner"><span>format-txn</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-history"><div class="inner"><span>history</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-insert"><div class="inner"><span>insert</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-insert.21"><div class="inner"><span>insert!</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-load"><div class="inner"><span>load</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-notify"><div class="inner"><span>notify</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-promise-wrap"><div class="inner"><span>promise-wrap</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-query"><div class="inner"><span>query</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-query-connection"><div class="inner"><span>query-connection</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-query-nameservice"><div class="inner"><span>query-nameservice</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-range"><div class="inner"><span>range</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-reason"><div class="inner"><span>reason</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-reasoned-count"><div class="inner"><span>reasoned-count</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-reasoned-facts"><div class="inner"><span>reasoned-facts</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-slice"><div class="inner"><span>slice</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-stage"><div class="inner"><span>stage</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-status"><div class="inner"><span>status</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-transact.21"><div class="inner"><span>transact!</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-trigger-index"><div class="inner"><span>trigger-index</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-update"><div class="inner"><span>update</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-update.21"><div class="inner"><span>update!</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-upsert"><div class="inner"><span>upsert</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-upsert.21"><div class="inner"><span>upsert!</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-wrap-class-policy"><div class="inner"><span>wrap-class-policy</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-wrap-identity-policy"><div class="inner"><span>wrap-identity-policy</span></div></a></li><li class="depth-1"><a href="fluree.db.api.html#var-wrap-policy"><div class="inner"><span>wrap-policy</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">fluree.db.api</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-address.3F"><h3>address?</h3><div class="usage"><code>(address? ledger-alias-or-address)</code></div><div class="doc"><pre class="plaintext">Returns true if the argument is a full ledger address, false if it is just an
alias.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L230">view source</a></div></div><div class="public anchor" id="var-alias-.3Eaddress"><h3>alias-&gt;address</h3><div class="usage"><code>(alias-&gt;address conn ledger-alias)</code></div><div class="doc"><pre class="plaintext">Resolves a ledger alias to its address.

Returns a core.async channel containing the address.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L257">view source</a></div></div><div class="public anchor" id="var-commit.21"><h3>commit!</h3><div class="usage"><code>(commit! conn db)</code><code>(commit! conn db opts)</code></div><div class="doc"><pre class="plaintext">Persists a staged database as a new immutable version in the ledger.

Parameters:
  conn - Connection object
  db - Staged database with changes to commit
  opts - (optional) Options map for the commit operation

The ledger-id is automatically extracted from the database object's
alias and branch fields (formatted as alias@branch).

Creates a new commit and notifies the nameservice of the new version.
Returns promise resolving to the committed database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L381">view source</a></div></div><div class="public anchor" id="var-connect"><h3>connect</h3><div class="usage"><code>(connect config)</code></div><div class="doc"><pre class="plaintext">Creates a connection from a JSON-LD configuration map.

Config should contain @graph with storage, connection, and optional system definitions.
Returns a promise that resolves to a connection object.

See documentation for configuration schema.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L54">view source</a></div></div><div class="public anchor" id="var-connect-file"><h3>connect-file</h3><div class="usage"><code>(connect-file)</code><code>(connect-file {:keys [storage-path parallelism cache-max-mb defaults aes256-key], :or {storage-path "data", parallelism 4, cache-max-mb 1000}})</code></div><div class="doc"><pre class="plaintext">Forms a connection backed by local file storage.

Options:
  - storage-path (optional): Directory path for file storage (default: "data")
  - parallelism (optional): Number of parallel operations (default: 4)
  - cache-max-mb (optional): Maximum memory for caching in MB (default: 1000)
  - aes256-key (optional): AES-256 encryption key for file storage encryption.
    When provided, all data will be encrypted using AES-256-CBC with PKCS5 padding.
    The key should be exactly 32 bytes long for optimal security.
    Example: "my-secret-32-byte-encryption-key!"
  - defaults (optional): Default options for ledgers created with this connection

Returns a core.async channel that resolves to a connection, or an exception if
the connection cannot be established.

Examples:
  ;; Basic file storage
  (connect-file {:storage-path "./my-data"})
  
  ;; File storage with encryption
  (connect-file {:storage-path "./secure-data"
                 :aes256-key "my-secret-32-byte-encryption-key!"})
                 
  ;; Full configuration
  (connect-file {:storage-path "./data"
                 :parallelism 8
                 :cache-max-mb 2000
                 :aes256-key "my-secret-32-byte-encryption-key!"})</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L124">view source</a></div></div><div class="public anchor" id="var-connect-memory"><h3>connect-memory</h3><div class="usage"><code>(connect-memory)</code><code>(connect-memory {:keys [parallelism cache-max-mb defaults], :or {parallelism 4, cache-max-mb 1000}})</code></div><div class="doc"><pre class="plaintext">Creates an in-memory connection with default settings.

Options map (all optional):
  :parallelism - Number of parallel operations (default: 4)
  :cache-max-mb - Maximum cache size in MB (default: 1000)
  :defaults - Default settings map for operations</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L97">view source</a></div></div><div class="public anchor" id="var-connect-s3"><h3>connect-s3</h3><div class="usage"><code>(connect-s3 {:keys [s3-bucket s3-prefix s3-endpoint parallelism cache-max-mb defaults s3-read-timeout-ms s3-write-timeout-ms s3-list-timeout-ms s3-max-retries s3-retry-base-delay-ms s3-retry-max-delay-ms], :or {parallelism 4, cache-max-mb 1000}})</code></div><div class="doc"><pre class="plaintext">Forms a connection backed by S3 storage.

Options:
  - s3-bucket (required): The S3 bucket name
  - s3-endpoint (required): S3 endpoint URL
    * For AWS S3: '<a href="https://s3.&lt;region&gt;.amazonaws.com&amp;apos">https://s3.&lt;region&gt;.amazonaws.com&amp;apos</a>; (e.g., '<a href="https://s3.us-east-1.amazonaws.com')">https://s3.us-east-1.amazonaws.com')</a>
    * For LocalStack: '<a href="http://localhost:4566&amp;apos">http://localhost:4566&amp;apos</a>;
    * For MinIO: '<a href="http://localhost:9000&amp;apos">http://localhost:9000&amp;apos</a>;
  - s3-prefix (optional): The prefix within the bucket
  - s3-read-timeout-ms (optional): Per-request read timeout (default 20000)
  - s3-write-timeout-ms (optional): Per-request write timeout (default 60000)
  - s3-list-timeout-ms (optional): Per-request list timeout (default 20000)
  - s3-max-retries (optional): Max retry attempts on transient errors (default 4)
  - s3-retry-base-delay-ms (optional): Base backoff delay in ms (default 150)
  - s3-retry-max-delay-ms (optional): Max backoff delay in ms (default 2000)
  - parallelism (optional): Number of parallel operations (default: 4)
  - cache-max-mb (optional): Maximum memory for caching in MB (default: 1000)
  - defaults (optional): Default options for ledgers created with this connection</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L176">view source</a></div></div><div class="public anchor" id="var-convert-config-key"><h3>convert-config-key</h3><div class="usage"><code>(convert-config-key [k v])</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L81">view source</a></div></div><div class="public anchor" id="var-convert-keys"><h3>convert-keys</h3><div class="usage"><code>(convert-keys m)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L89">view source</a></div></div><div class="public anchor" id="var-create"><h3>create</h3><div class="usage"><code>(create conn ledger-alias)</code><code>(create conn ledger-alias opts)</code></div><div class="doc"><pre class="plaintext">Creates a new ledger with an initial empty commit at t=0.
Returns a promise that resolves to the initial database.

Parameters:
  conn - Connection object
  ledger-alias - Unique alias/name for the ledger
  opts - (optional) Options map:
    :branch - Branch name (default: "main")
    :did - DID for signing commits
    :context - Default JSON-LD context
    :indexing - Indexing configuration</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L236">view source</a></div></div><div class="public anchor" id="var-create-with-txn"><h3>create-with-txn</h3><div class="usage"><code>(create-with-txn conn txn)</code><code>(create-with-txn conn txn opts)</code></div><div class="doc"><pre class="plaintext">Creates a new ledger and applies an initial transaction.

Parameters:
  conn - Connection object
  txn - Transaction map containing:
    'ledger' - Ledger alias (required)
    'insert'/'delete'/'where' - Transaction operations
  opts - (optional) Additional options

Returns promise resolving to initial database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L516">view source</a></div></div><div class="public anchor" id="var-credential-history"><h3>credential-history</h3><div class="usage"><code>(credential-history conn ledger-id cred-query)</code><code>(credential-history conn ledger-id cred-query override-opts)</code></div><div class="doc"><pre class="plaintext">Executes a history query using a verifiable credential.

Parameters:
  conn - Connection object
  ledger-id - Ledger alias or address
  cred-query - Verifiable credential containing history query
  opts - (optional) Options map

Verifies credential and applies identity-based policies.
Returns promise resolving to historical data.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L770">view source</a></div></div><div class="public anchor" id="var-credential-query"><h3>credential-query</h3><div class="usage"><code>(credential-query ds cred-query)</code><code>(credential-query ds cred-query {:keys [values-map format], :as opts})</code></div><div class="doc"><pre class="plaintext">Executes a query using a verifiable credential.

Parameters:
  ds - Database value or dataset
  cred-query - Verifiable credential containing query
  opts - (optional) Options map:
    :values-map - Values for policy variables
    :format - Query format (:sparql or default)

Verifies credential signature and applies identity-based policies.
Returns promise resolving to query results.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L665">view source</a></div></div><div class="public anchor" id="var-credential-query-connection"><h3>credential-query-connection</h3><div class="usage"><code>(credential-query-connection conn cred-query)</code><code>(credential-query-connection conn cred-query {:keys [format], :as opts})</code></div><div class="doc"><pre class="plaintext">Executes a query via connection using a verifiable credential.

Parameters:
  conn - Connection object
  cred-query - Verifiable credential containing query
  opts - (optional) Options map

Verifies credential and applies identity-based policies.
Returns promise resolving to query results.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L703">view source</a></div></div><div class="public anchor" id="var-credential-transact.21"><h3>credential-transact!</h3><h4 class="deprecated">deprecated</h4><div class="usage"><code>(credential-transact! conn txn)</code><code>(credential-transact! conn txn opts)</code></div><div class="doc"><pre class="plaintext">Deprecated: Use `credential-update!` instead.

Executes a transaction using a verifiable credential.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L509">view source</a></div></div><div class="public anchor" id="var-credential-update.21"><h3>credential-update!</h3><div class="usage"><code>(credential-update! conn credential)</code><code>(credential-update! conn credential opts)</code></div><div class="doc"><pre class="plaintext">Stages updates to a database and commits using a verifiable credential.

Parameters:
  conn - Connection object
  credential - Verifiable credential containing transaction with:
    'from' or 'ledger' - Ledger identifier
    JSON-LD document with transaction operations
  opts - (optional) Options map:
    :context - Override default context

Verifies credential signature and applies identity-based policies.
Equivalent to calling `update!` with credential verification.
Returns promise resolving to committed database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L489">view source</a></div></div><div class="public anchor" id="var-dataset"><h3>dataset</h3><div class="usage"><code>(dataset named-graphs)</code><code>(dataset named-graphs default-graphs)</code></div><div class="doc"><pre class="plaintext">Creates a composed dataset from multiple resolved graph databases.

The databases to be composed are supplied as a map with a string alias
as they key, and the resolved graph db as the value.

By default, every resolved graph db will be composed together as a new
default graph which will be used for all where clauses in queries that
do *not* specify a specific graph to target, which is done using the
special `graph` syntax in the where clause.

If just one or more of the supplied graph dbs should instead be used as
the default graph (instead of all of them), supply the second argument
as a list of the db aliases in the db-map that should be used as the
default.

Targeting a single named graph in a query (as opposed to the default graph)
is done by using the `graph` syntax within the 'where' clause, for example:
{...
 'where': [...
           ['graph' &lt;graph-alias&gt; &lt;query-pattern&gt;]]
 ...}</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L623">view source</a></div></div><div class="public anchor" id="var-db"><h3>db</h3><div class="usage"><code>(db conn ledger-id)</code></div><div class="doc"><pre class="plaintext">Returns the current database value from a ledger.

Parameters:
  conn - Connection object
  ledger-id - Ledger alias or address
  
Returns the current database value.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L558">view source</a></div></div><div class="public anchor" id="var-decode-iri"><h3>decode-iri</h3><div class="usage"><code>(decode-iri db iri)</code></div><div class="doc"><pre class="plaintext">Decodes a Fluree internal identifier back to an IRI string.

Parameters:
  db - Database value
  iri - Encoded identifier to decode

Opposite of encode-iri. Used when working with raw index data.
Returns the full IRI string.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L848">view source</a></div></div><div class="public anchor" id="var-disconnect"><h3>disconnect</h3><div class="usage"><code>(disconnect conn)</code></div><div class="doc"><pre class="plaintext">Terminates a connection and releases associated resources.
Returns a promise that resolves when disconnection is complete.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L73">view source</a></div></div><div class="public anchor" id="var-drop"><h3>drop</h3><div class="usage"><code>(drop conn ledger-alias)</code></div><div class="doc"><pre class="plaintext">Deletes a ledger and its associated data.
Returns a promise that resolves when deletion is complete.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L275">view source</a></div></div><div class="public anchor" id="var-encode-iri"><h3>encode-iri</h3><div class="usage"><code>(encode-iri db iri)</code></div><div class="doc"><pre class="plaintext">Encodes an IRI to Fluree's internal compact format.

Parameters:
  db - Database value  
  iri - IRI string to encode

Used for range scans, slices and advanced index operations.
Returns the encoded identifier.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L836">view source</a></div></div><div class="public anchor" id="var-exists.3F"><h3>exists?</h3><div class="usage"><code>(exists? conn ledger-alias-or-address)</code></div><div class="doc"><pre class="plaintext">Returns a promise with true if the ledger alias or address exists, false
otherwise.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L282">view source</a></div></div><div class="public anchor" id="var-expand-iri"><h3>expand-iri</h3><div class="usage"><code>(expand-iri context compact-iri)</code></div><div class="doc"><pre class="plaintext">Expands a compact IRI to its full form using the context.

Parameters:
  context - JSON-LD context for expansion
  compact-iri - The compact IRI to expand

Returns the expanded IRI string.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L824">view source</a></div></div><div class="public anchor" id="var-format-txn"><h3>format-txn</h3><div class="usage"><code>(format-txn txn override-opts)</code></div><div class="doc"><pre class="plaintext">Converts SPARQL Update syntax to Fluree transaction format.

Parameters:
  txn - Transaction data (string or map)
  override-opts - Options map with :format key

If :format is :sparql, parses SPARQL Update and converts to JSON-LD Query.
Otherwise returns txn unchanged.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L369">view source</a></div></div><div class="public anchor" id="var-history"><h3>history</h3><div class="usage"><code>(history conn ledger-id query)</code><code>(history conn ledger-id query override-opts)</code></div><div class="doc"><pre class="plaintext">Queries the history of entities across commits.

Parameters:
  conn - Connection object
  ledger-id - Ledger alias or address
  query - Query map with:
    'history' - Subject IRI or pattern
    't' - Specific time or {'from': t1, 'to': t2}
    'commit-details' - Include commit metadata (default: false)
  opts - (optional) Options map

Returns promise resolving to historical flakes.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L748">view source</a></div></div><div class="public anchor" id="var-insert"><h3>insert</h3><div class="usage"><code>(insert db rdf)</code><code>(insert db rdf opts)</code></div><div class="doc"><pre class="plaintext">Stages insertion of new entities into a database.

Parameters:
  db - Database value
  rdf - JSON-LD or Turtle RDF data to insert
  opts - (optional) Options map:
    :context - Context override (ignored if present in json-ld)
    :format - Data format (:json-ld default, or :turtle)

Throws exception if any entity @id already exists.
For insert-or-update behavior, use `upsert`.

Returns promise resolving to updated database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L310">view source</a></div></div><div class="public anchor" id="var-insert.21"><h3>insert!</h3><div class="usage"><code>(insert! conn ledger-id txn)</code><code>(insert! conn ledger-id txn opts)</code></div><div class="doc"><pre class="plaintext">Stages insertion of new entities and commits in one atomic operation.

Parameters:
  conn - Connection object
  ledger-id - Ledger alias or address
  rdf - JSON-LD or Turtle RDF data to insert
  opts - (optional) Options map:
    :context - Context override (ignored if present in json-ld)
    :format - Data format (:json-ld default, or :turtle)

Throws exception if any entity @id already exists.
For insert-or-update behavior, use `upsert!`.
Equivalent to calling `insert` then `commit!`.
Returns promise resolving to committed database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L468">view source</a></div></div><div class="public anchor" id="var-load"><h3>load</h3><div class="usage"><code>(load conn alias-or-address)</code></div><div class="doc"><pre class="plaintext">Loads an existing ledger by alias or address.
Returns a promise that resolves to the latest database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L265">view source</a></div></div><div class="public anchor" id="var-notify"><h3>notify</h3><div class="usage"><code>(notify conn commit-address commit-hash)</code></div><div class="doc"><pre class="plaintext">Notifies the connection of a new commit for maintaining current db state.

Parameters:
  conn - Connection object
  commit-address - Address where commit is stored
  commit-hash - Hash of the commit

Updates in-memory ledger if commit is next in sequence.
Returns promise resolving when notification is processed.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L295">view source</a></div></div><div class="public anchor" id="var-promise-wrap"><h3>promise-wrap</h3><div class="usage"><code>(promise-wrap port)</code></div><div class="doc"><pre class="plaintext">Wraps an async channel that will contain a response in a promise.
</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L27">view source</a></div></div><div class="public anchor" id="var-query"><h3>query</h3><div class="usage"><code>(query ds q)</code><code>(query ds q opts)</code></div><div class="doc"><pre class="plaintext">Executes a query against a database or dataset.

Parameters:
  ds - Database value or dataset
  q - Query map (JSON-LD or analytical)
  opts - (optional) Options map

Returns promise resolving to query results.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L649">view source</a></div></div><div class="public anchor" id="var-query-connection"><h3>query-connection</h3><div class="usage"><code>(query-connection conn q)</code><code>(query-connection conn q opts)</code></div><div class="doc"><pre class="plaintext">Executes a query using the connection's query engine.

Parameters:
  conn - Connection object
  q - Query map with 'from' key specifying ledger
  opts - (optional) Options map

Uses the current database state at query time.
Returns promise resolving to query results.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L688">view source</a></div></div><div class="public anchor" id="var-query-nameservice"><h3>query-nameservice</h3><div class="usage"><code>(query-nameservice conn query)</code><code>(query-nameservice conn query opts)</code></div><div class="doc"><pre class="plaintext">Executes a query against all nameservice records.

Parameters:
  conn - Connection object
  query - Query map in JSON-LD format
  opts - (optional) Options map

Creates a temporary in-memory ledger from all nameservice records and
executes the query against it. Useful for queries like 'find all branches
for ledger xyz' or 'find all ledgers where t=42'.

Returns promise resolving to query results.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L724">view source</a></div></div><div class="public anchor" id="var-range"><h3>range</h3><div class="usage"><code>(range db index test match)</code><code>(range db index start-test start-match end-test end-match)</code></div><div class="doc"><pre class="plaintext">Performs a range scan on a database index.

Parameters:
  db - Database value
  index - Index name (:spot, :psot, :post, :opst, :tspo)
  test - Test function (&gt;=, &lt;=, &gt;, &lt;) or start-test for two-sided
  match - Value to match or start-match for two-sided
  end-test - (optional) End test function for two-sided range
  end-match - (optional) End value for two-sided range

Returns promise resolving to matching flakes.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L791">view source</a></div></div><div class="public anchor" id="var-reason"><h3>reason</h3><div class="usage"><code>(reason db methods)</code><code>(reason db methods rule-sources)</code><code>(reason db methods rule-sources opts)</code></div><div class="doc"><pre class="plaintext">Applies reasoning rules to a database.

Parameters:
  db - Database value
  methods - Reasoner method or vector of methods (:datalog, :owl2rl)
  rule-sources - (optional) JSON-LD rules or nil to use rules from db
  opts - (optional) Options map

Reasoning is done in-memory and not persisted.
Returns promise resolving to reasoning-enabled database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L862">view source</a></div></div><div class="public anchor" id="var-reasoned-count"><h3>reasoned-count</h3><div class="usage"><code>(reasoned-count db)</code></div><div class="doc"><pre class="plaintext">Returns the number of facts inferred by reasoning.

Must have reasoning enabled on the database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L879">view source</a></div></div><div class="public anchor" id="var-reasoned-facts"><h3>reasoned-facts</h3><div class="usage"><code>(reasoned-facts db)</code><code>(reasoned-facts db opts)</code></div><div class="doc"><pre class="plaintext">Returns facts inferred by reasoning.

Parameters:
  db - Database value with reasoning enabled
  opts - (optional) Options map:
    :group-by - Grouping option (:rule, :subject, or :property)

Returns 4-tuples of [subject-iri property-iri object rule-id]
where rule-id is the identifier of the rule that generated the fact.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L886">view source</a></div></div><div class="public anchor" id="var-slice"><h3>slice</h3><div class="usage"><code>(slice db index match)</code></div><div class="doc"><pre class="plaintext">Returns all flakes that exactly match the supplied pattern.

Parameters:
  db - Database value
  index - Index name (:spot, :psot, :post, :opst, :tspo)
  match - Flake pattern to match

Returns promise resolving to matching flakes.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L811">view source</a></div></div><div class="public anchor" id="var-stage"><h3>stage</h3><h4 class="deprecated">deprecated</h4><div class="usage"><code>(stage db json-ld)</code><code>(stage db json-ld opts)</code></div><div class="doc"><pre class="plaintext">Renamed to `update`, prefer that API instead.
</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L364">view source</a></div></div><div class="public anchor" id="var-status"><h3>status</h3><div class="usage"><code>(status conn ledger-id)</code><code>(status conn ledger-id branch)</code></div><div class="doc"><pre class="plaintext">Returns current status of a ledger branch.

Parameters:
  conn - Connection object
  ledger-id - Ledger alias or address
  branch - (optional) Branch name (defaults to current branch)

Returns status map with commit and index information.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L536">view source</a></div></div><div class="public anchor" id="var-transact.21"><h3>transact!</h3><h4 class="deprecated">deprecated</h4><div class="usage"><code>(transact! conn txn)</code><code>(transact! conn txn opts)</code></div><div class="doc"><pre class="plaintext">Deprecated: Use `update!` instead.

Updates a ledger and commits the changes in one operation.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L406">view source</a></div></div><div class="public anchor" id="var-trigger-index"><h3>trigger-index</h3><div class="usage"><code>(trigger-index conn ledger-alias)</code><code>(trigger-index conn ledger-alias opts)</code></div><div class="doc"><pre class="plaintext">Manually triggers indexing for a ledger and waits for completion.

This is useful for external indexing processes (e.g., AWS Lambda) that need
to ensure a ledger is indexed without creating new transactions.

Parameters:
  conn - Database connection
  ledger-alias - The alias/name of the ledger to index
  opts - (optional) Options map:
    :branch - Branch name (defaults to main branch)
    :timeout - Max wait time in ms (default 300000 / 5 minutes)

Returns a promise that resolves to the indexed database object.
Throws an exception if indexing fails or times out.

Example:
  ;; Trigger indexing and wait for completion
  (let [indexed-db @(trigger-index conn "my-ledger")]
    ;; Use indexed-db...
    )</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L901">view source</a></div></div><div class="public anchor" id="var-update"><h3>update</h3><div class="usage"><code>(update db json-ld)</code><code>(update db json-ld opts)</code></div><div class="doc"><pre class="plaintext">Stages updates to a database without committing.

Parameters:
  db - Database value
  json-ld - JSON-LD document with transaction operations
  opts - (optional) Options map:
    :context - Override default context

Multiple updates can be staged and committed together.
Returns promise resolving to updated database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L347">view source</a></div></div><div class="public anchor" id="var-update.21"><h3>update!</h3><div class="usage"><code>(update! conn ledger-id txn opts)</code><code>(update! conn a b)</code><code>(update! conn txn)</code></div><div class="doc"><pre class="plaintext">Stages updates to a database and commits in one atomic operation.

Parameters:
  conn - Connection object
  ledger-id - Ledger alias or address (preferred signature)
  txn - JSON-LD Update (FQL or SPARQL per :format)
  opts - (optional) Options map:
    :context - Override default context

Equivalent to calling `update` then `commit!`.
Returns promise resolving to committed database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L416">view source</a></div></div><div class="public anchor" id="var-upsert"><h3>upsert</h3><div class="usage"><code>(upsert db rdf)</code><code>(upsert db rdf opts)</code></div><div class="doc"><pre class="plaintext">Stages insertion or update of entities.

Parameters:
  db - Database value
  rdf - JSON-LD or Turtle RDF data to upsert
  opts - (optional) Options map:
    :context - Context override (ignored if present in json-ld)
    :format - Data format (:json-ld default, or :turtle)

Creates new entities or updates existing ones based on @id.

Returns promise resolving to updated database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L329">view source</a></div></div><div class="public anchor" id="var-upsert.21"><h3>upsert!</h3><div class="usage"><code>(upsert! conn ledger-id txn)</code><code>(upsert! conn ledger-id txn opts)</code></div><div class="doc"><pre class="plaintext">Stages insertion or update of entities and commits in one atomic operation.

Parameters:
  conn - Connection object
  ledger-id - Ledger alias or address
  rdf - JSON-LD or Turtle RDF data to upsert
  opts - (optional) Options map:
    :context - Context override (ignored if present in json-ld)
    :format - Data format (:json-ld default, or :turtle)

Creates new entities or updates existing ones based on @id.
Equivalent to calling `upsert` then `commit!`.
Returns promise resolving to committed database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L448">view source</a></div></div><div class="public anchor" id="var-wrap-class-policy"><h3>wrap-class-policy</h3><div class="usage"><code>(wrap-class-policy db policy-classes)</code><code>(wrap-class-policy db policy-classes policy-values)</code></div><div class="doc"><pre class="plaintext">Applies policy restrictions based on policy classes in the database.

Parameters:
  db - Database value
  policy-classes - IRI or vector of IRIs of policy classes
  policy-values - (optional) Values for policy variables

Finds and applies all policies with matching @type.
Returns promise resolving to policy-wrapped database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L589">view source</a></div></div><div class="public anchor" id="var-wrap-identity-policy"><h3>wrap-identity-policy</h3><div class="usage"><code>(wrap-identity-policy db identity)</code><code>(wrap-identity-policy db identity policy-values)</code></div><div class="doc"><pre class="plaintext">Applies policy restrictions based on an identity's policy classes.

Parameters:
  db - Database value
  identity - IRI of the identity
  policy-values - (optional) Values for policy variables

Looks up the identity's f:policyClass property and applies
all policies with those class IRIs.

Returns promise resolving to policy-wrapped database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L605">view source</a></div></div><div class="public anchor" id="var-wrap-policy"><h3>wrap-policy</h3><div class="usage"><code>(wrap-policy db policy)</code><code>(wrap-policy db policy policy-values)</code></div><div class="doc"><pre class="plaintext">Applies policy restrictions to a database.

Parameters:
  db - Database value
  policy - JSON-LD policy document
  policy-values - (optional) Values for policy variables

Returns promise resolving to policy-wrapped database.</pre></div><div class="src-link"><a href="https://github.com/fluree/db/blob/v3.0.0-alpha2/src/fluree/db/api.cljc#L573">view source</a></div></div></div></body></html>